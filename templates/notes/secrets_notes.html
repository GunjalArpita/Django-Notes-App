<!DOCTYPE html>
<html>
<head>
    <title>Secret Notes</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body style="background: linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%);">
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow-lg border-0">
                <div class="card-header bg-gradient bg-primary text-white text-center">
                    <h2 class="mb-0">üòâ Secret Notes</h2>
                </div>
                <div class="card-body">
                    <h4 class="text-primary mb-4">Your Secret Notes</h4>
                    {% if move_message %}
                        <script>
                        document.addEventListener('DOMContentLoaded', function() {
                            var toast = document.createElement('div');
                            toast.className = 'toast align-items-center text-bg-success border-0 position-fixed start-50 translate-middle-x mt-4';
                            toast.style.top = '0';
                            toast.style.zIndex = '9999';
                            toast.role = 'alert';
                            toast.ariaLive = 'assertive';
                            toast.ariaAtomic = 'true';
                            toast.innerHTML = '<div class="d-flex"><div class="toast-body">{{ move_message }}</div><button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button></div>';
                            document.body.appendChild(toast);
                            var bsToast = new bootstrap.Toast(toast, { delay: 2000 });
                            bsToast.show();
                            setTimeout(function() { document.body.removeChild(toast); }, 2200);
                        });
                        </script>
                    {% endif %}
                    {% if secret_notes %}
                        <div class="row">
                            {% for note in secret_notes %}
                                <div class="col-md-6 mb-3">
                                    <div class="card border-primary shadow-sm h-100" style="background-color: #e3e6f5;">
                                        <div class="card-body">
                                            <h5 class="card-title text-primary"><span style="font-size:1.5em;">üîí</span> <a href="{% url 'view_secret_note' note.id %}" class="text-decoration-none text-primary" style="font-weight:bold;">{{ note.title }}</a></h5>
                                            <p class="card-text">{{ note.content }}</p>
                                        </div>
                                        <div class="card-footer bg-white border-top-0 d-flex justify-content-between align-items-center">
                                            <small class="text-muted">üóìÔ∏è {{ note.created_at|date:"M d, Y H:i" }}</small>
                                            <div>
                                                    <a href="{% url 'edit_secret_note' note.id %}" class="btn btn-sm btn-outline-warning me-2" data-bs-toggle="tooltip" data-bs-placement="top" title="Edit">‚úèÔ∏è Edit</a>
                                                    <button type="button" class="btn btn-sm btn-outline-danger" data-bs-toggle="modal" data-bs-target="#confirmDeleteModal{{ note.id }}" data-bs-toggle="tooltip" data-bs-placement="top" title="Delete">üóëÔ∏è Delete</button>
                                                    <!-- Delete Confirmation Modal -->
                                                    <div class="modal fade" id="confirmDeleteModal{{ note.id }}" tabindex="-1" aria-labelledby="confirmDeleteLabel{{ note.id }}" aria-hidden="true">
                                                        <div class="modal-dialog modal-dialog-centered">
                                                            <div class="modal-content">
                                                                <div class="modal-header bg-danger text-white">
                                                                    <h5 class="modal-title" id="confirmDeleteLabel{{ note.id }}">Confirm Delete</h5>
                                                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                                </div>
                                                                <div class="modal-body text-center">
                                                                    <span style="font-size:2em;">‚ö†Ô∏è</span>
                                                                    <p class="mt-3 mb-0">Are you sure you want to delete this secret note?</p>
                                                                </div>
                                                                <div class="modal-footer justify-content-center">
                                                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                                                    <a href="{% url 'delete_secret_note' note.id %}" class="btn btn-danger">Yes, Delete</a>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <p class="text-muted">No secret notes yet.</p>
                    {% endif %}
                    <hr>
                    <h5 class="text-primary mb-3">Add a New Secret Note</h5>
                    <form method="post" class="mb-2" autocomplete="off" enctype="multipart/form-data">
                        {% csrf_token %}
                        <div class="mb-3">
                            <label class="form-label text-primary">Title</label>
                            <input type="text" name="title" class="form-control" placeholder="Enter secret title" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label text-primary">Content</label>
                            <div class="input-group">
                                <textarea id="secretContentInput" name="content" class="form-control" rows="4" placeholder="Enter secret content" required></textarea>
                                <button type="button" class="btn btn-outline-primary" id="secretMicBtn" title="Speak your note">
                                    <span style="font-size:1.3em;">üé§</span>
                                </button>
                            </div>
                            <small class="text-muted">You can type ‚úçÔ∏è or use speech üé§ to add your secret note.</small>
                        </div>
                        <div class="mb-3">
                            <label class="form-label text-primary">Attach Files <span style="font-size:1.2em;">üìé</span></label>
                            <input type="file" name="files" multiple class="form-control">
                            <small class="text-muted">You can upload documents, photos, or other files.</small>
                        </div>
                        <div class="d-flex justify-content-between">
                            <button type="submit" class="btn btn-primary">Add Secret Note</button>
                            <a href="{% url 'notes_list' %}" class="btn btn-secondary ms-2">Back</a>
                        </div>
                    </form>
                    <script>
                    let recognizing = false;
                    let recognition;
                    const micBtn = document.getElementById('secretMicBtn');
                    const contentInput = document.getElementById('secretContentInput');
                    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                        recognition = new SpeechRecognition();
                        recognition.continuous = false;
                        recognition.interimResults = false;
                        recognition.lang = 'en-US';
                        recognition.onresult = function(event) {
                            const transcript = event.results[0][0].transcript;
                            contentInput.value += (contentInput.value ? ' ' : '') + transcript;
                        };
                        recognition.onend = function() {
                            recognizing = false;
                            micBtn.classList.remove('active');
                            micBtn.innerHTML = '<span style="font-size:1.3em;">üé§</span>';
                        };
                        micBtn.onclick = function() {
                            if (!recognizing) {
                                recognition.start();
                                recognizing = true;
                                micBtn.classList.add('active');
                                micBtn.innerHTML = '<span style="font-size:1.3em;">üõë</span>';
                            } else {
                                recognition.stop();
                            }
                        };
                    } else {
                        micBtn.disabled = true;
                        micBtn.title = 'Speech recognition not supported in this browser.';
                    }
                    </script>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
</script>
</body>
</html>
